<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<script src='socket.io-client/dist/socket.io.js'></script>
	<script src='socketio-file-upload/client.min.js'></script>
</head>
<body>
	<script>
		function add_i_file() {
			const i_file = document.createElement('input')
			i_file.type = 'file'
			i_file.onchange = (event) => {
				console.log(event.target.files)
				setTimeout(() => {
					add_btn(i_file)
				}, 1000)
			}
			document.body.prepend(i_file)
		}
		function add_btn(i_file) {
			const e_click = new MouseEvent('click')
			const btn = document.createElement('btn')
			document.body.append(btn)
			setTimeout(() => {
				var socket = io();
				socket.nsp = '/cate';
				var uploader = new SocketIOFileUpload(socket);
				uploader.listenOnSubmit(btn, i_file);
				uploader.addEventListener("start", function(event){
				    event.file.meta.hello = "berhasil";
				});	
				btn.dispatchEvent(e_click)
			}, 1000)
		}
		setTimeout(() => {
			add_i_file()
		}, 1000)
	</script>
	<script>
		function notifyMe() {
			// Let's check if the browser supports notifications
			if (!("Notification" in window)) {
				alert("This browser does not support desktop notification");
			}
			// Let's check whether notification permissions have already been granted
			else if (Notification.permission === "granted") {
				// If it's okay let's create a notification
				var notif = new Notification("Ini Title",{
					body: 'ini body',
					icon: 'http://localhost:3000/uploads/contextmenu.png',
					data: {foo: 'bar', bar: 'baz'}
				});
				notif.onclose = function(e){
					console.log('onClose: ', e)
				}
				notif.onshow = function(e){
					console.log('onShow: ', e)
				}
				notif.onclick = function(e){
					console.log('onClick: ', e)
					let tag_a = document.createElement('a')
					tag_a.href = 'http://localhost:3000/uploads/contextmenu.png';
					tag_a.target = '_blank';
					let event_click = new MouseEvent('click')
					let event_close = new MouseEvent('close')
					console.log('tag_a: ', tag_a)
					console.log('this: ', this)
					notif.dispatchEvent(event_close)
					tag_a.dispatchEvent(event_click)
				}
				console.log('notif: ', notif)

			}
			// Otherwise, we need to ask the user for permission
			else if (Notification.permission !== "denied") {
				Notification.requestPermission(function (permission) {
					// If the user accepts, let's create a notification
					if (permission === "granted") {
						var notif = new Notification("Ini Title");
						notif.icon = 'http://localhost:3000/uploads/contextmenu.png';
						console.log('notif: ', notif)
					}
				});
			}
			// At last, if the user has denied notifications, and you 
			// want to be respectful there is no need to bother them any more.
		}
		notifyMe();
	</script>
</body>
</html>





